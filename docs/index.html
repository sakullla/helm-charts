<!DOCTYPE html>
<html>
<head>
  <title>Helm Charts Repository</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.0/css/bootstrap.min.css" integrity="sha512-P5MgMn1jBN01asBgU0z60Qk4QxiXo86+wlFahKrsQf37c9cro517WzVSPPV1tDKzhku2iJ2FVgL67wG03SGnNA==" crossorigin="anonymous" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.0/js/bootstrap.min.js" integrity="sha512-XKa9Hemdy1Ui3KSGgJdgMyYlUg1gM+QhL6cnlyTe2qzMCYm4nAZ1PsVerQzTTXzonUR+dmswHqgJPuwCq1MaAg==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js" integrity="sha512-CSBhVREyzHAjAFfDeqSG2N5XHryT3R/YV5X/vLFXlCS7mxx3iPOXQOxsOyiJGjZS7TzXI8OQZ2T+rXPYXX/D/g==" crossorigin="anonymous"></script>
  <style>
    .card { margin-bottom: 20px; box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2); transition: 0.3s; }
    .card:hover { box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2); }
    .card-header { font-weight: bold; background-color: #0091d3; color: white; }
    .copy-btn { cursor: pointer; color: #0091d3; float: right;}
  </style>
</head>
<body>
  <div class="container">
    <div class="jumbotron mt-3 text-center" style="background-color: #f8f9fa;">
      <h1 class="display-4">☸️ Helm Charts</h1>
      <p class="lead">My Personal Helm Repository</p>
      <hr class="my-4">
      <p>Add this repo: <code>helm repo add my-repo <span id="repo-url"></span></code></p>
    </div>
    <div class="row" id="chart-list"></div>
  </div>

  <script>
    // 自动获取当前 URL 作为仓库地址
    document.getElementById('repo-url').innerText = window.location.href;

    // 读取 index.yaml 并渲染
    $.get('index.yaml', function(data) {
      const doc = jsyaml.load(data);
      const entries = doc.entries;
      
      Object.keys(entries).forEach(key => {
        const chart = entries[key][0]; // 取最新版本
        const card = `
          <div class="col-md-6 col-lg-4">
            <div class="card h-100">
              <div class="card-header">
                ${chart.name} <span class="badge badge-light float-right">${chart.version}</span>
              </div>
              <div class="card-body">
                <p class="card-text">${chart.description || 'No description'}</p>
                <p class="text-muted"><small>App Version: ${chart.appVersion || '-'}</small></p>
                <button class="btn btn-sm btn-outline-primary" onclick="copyInstall('${chart.name}')">Copy Install Cmd</button>
              </div>
            </div>
          </div>
        `;
        $('#chart-list').append(card);
      });
    });

    function copyInstall(name) {
      const cmd = `helm install my-${name} my-repo/${name}`;
      navigator.clipboard.writeText(cmd).then(() => alert('Copied: ' + cmd));
    }
  </script>
</body>
</html>