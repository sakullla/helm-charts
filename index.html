<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sakullla's Helm Garden</title>
    
    <!-- È¢ÑËøûÊé•ÂÖ≥ÈîÆÂüüÂêç -->
    <link rel="preconnect" href="https://cdn.staticfile.net" crossorigin>
    <link rel="preconnect" href="https://github.githubassets.com" crossorigin>
    
    <!-- È¢ÑÂä†ËΩΩÂÖ≥ÈîÆËµÑÊ∫ê -->
    <link rel="preload" href="./avatar.jpg" as="image">
    
    <!-- CSS ËµÑÊ∫ê -->
    <link href="https://cdn.staticfile.net/twitter-bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.staticfile.net/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- ÂÖ≥ÈîÆ CSS ÂÜÖËÅî -->
    <style>
        /* --- ÂÖ®Â±ÄËÉåÊôØ --- */
        body {
            background: url('./bg.jpg') center/cover fixed no-repeat, 
                        linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
            font-family: 'Nunito', 'Segoe UI', 'Microsoft YaHei', sans-serif;
            min-height: 100vh;
        }

        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.3);
            z-index: -1;
        }

        /* --- ‰∏ªÂÆπÂô® --- */
        .glass-container {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
            margin-top: 50px;
            margin-bottom: 50px;
            border: 1px solid rgba(255, 255, 255, 0.6);
        }

        /* --- Â§¥ÂÉè --- */
        .avatar-container {
            position: relative; width: 120px; height: 120px; margin: 0 auto 15px;
        }
        .avatar {
            width: 100%; height: 100%;
            border-radius: 50%;
            border: 4px solid #fff;
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
            object-fit: cover;
            transition: transform 0.5s ease-in-out;
            background-color: white;
        }
        .avatar:hover { transform: rotate(15deg) scale(1.1); }

        h1 { color: #4a4a4a; font-weight: 800; letter-spacing: 1px; }
        .subtitle { color: #666; font-size: 1rem; font-weight: 500; }

        /* --- ÂëΩ‰ª§Ê°Ü --- */
        .cmd-box-wrapper {
            background: #2d2d2d;
            border-radius: 12px;
            padding: 18px;
            margin: 25px auto 15px;
            max-width: 650px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            text-align: left;
        }
        .cmd-text { color: #ff79c6; font-family: 'Consolas', monospace; font-size: 0.95em; word-break: break-all; }
        .cmd-label { color: #8be9fd; font-size: 0.85em; margin-bottom: 5px; display: block; font-weight: bold;}

        /* --- ÊêúÁ¥¢Ê°Ü --- */
        .search-wrapper {
            max-width: 650px;
            margin: 0 auto 30px;
            position: relative;
        }
        .search-input {
            width: 100%;
            padding: 12px 20px 12px 50px;
            border-radius: 50px;
            border: 2px solid rgba(255, 154, 158, 0.3);
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(5px);
            font-size: 1rem;
            color: #555;
            transition: all 0.3s ease;
        }
        .search-input:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.95);
            border-color: #ff9a9e;
            box-shadow: 0 0 15px rgba(255, 154, 158, 0.3);
        }
        .search-icon {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: #ff9a9e;
            pointer-events: none;
        }

        /* --- Âç°Áâá --- */
        .chart-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            transition: all 0.3s;
            overflow: hidden;
            height: 100%;
            border: 1px solid rgba(255,255,255,1);
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        .chart-card:hover {
            transform: translateY(-8px); 
            box-shadow: 0 15px 30px rgba(255, 117, 140, 0.25);
        }
        .card-header-custom {
            background: linear-gradient(120deg, #ff9a9e 0%, #fecfef 100%);
            color: white; padding: 15px 25px; font-weight: 700; font-size: 1.1rem;
        }
        .card-body { padding: 25px; }
        .card-desc { color: #666; font-size: 0.9rem; min-height: 45px; }
        .version-badge {
            background: rgba(255,255,255,0.3); color: #fff;
            padding: 3px 10px; border-radius: 12px; font-size: 0.8rem; float: right;
        }

        .btn-custom {
            background: linear-gradient(to right, #ff758c, #ff7eb3);
            color: white; border: none; border-radius: 50px; width: 100%; padding: 10px;
            font-weight: 600; transition: 0.3s;
        }
        .btn-custom:hover {
            transform: scale(1.02); box-shadow: 0 5px 15px rgba(255, 117, 140, 0.4); color: white;
        }

        /* --- Ê∂àÊÅØÊ∞îÊ≥° (Toast) --- */
        #toast-box {
            position: fixed; top: 30px; left: 50%; transform: translateX(-50%); z-index: 9999; pointer-events: none;
        }
        .sakura-toast {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 12px 25px;
            border-radius: 50px;
            box-shadow: 0 10px 25px rgba(255, 117, 140, 0.3);
            border: 2px solid #ff9a9e;
            color: #ff758c;
            font-weight: bold;
            display: flex; align-items: center; gap: 10px; margin-bottom: 10px;
            animation: slideDown 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55) forwards;
        }
        @keyframes slideDown { 0% { transform: translateY(-50px); opacity: 0; } 100% { transform: translateY(0); opacity: 1; } }
        @keyframes fadeOut { 0% { transform: translateY(0); opacity: 1; } 100% { transform: translateY(-30px); opacity: 0; } }
        .hide-toast { animation: fadeOut 0.5s forwards; }
        
        /* ÈöêËóèÁ±ª */
        .d-none { display: none !important; }
    </style>
</head>
<body>

<div class="overlay"></div>
<div id="toast-box"></div>

<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-10 glass-container">
            <div class="text-center">
                <div class="avatar-container">
                    <img src="./avatar.jpg" class="avatar" alt="Avatar" onerror="this.src='https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png'" loading="lazy">
                </div>
                <h1>Sakullla's Helm Garden</h1>
                <p class="subtitle">üå∏ Ê¨¢ËøéÊù•Âà∞ÊàëÁöÑ‰∫ëÂéüÁîüÈ≠îÊ≥ïÂêéËä±Âõ≠ üå∏</p>
                
                <div class="cmd-box-wrapper">
                    <span class="cmd-label"><i class="fas fa-terminal me-2"></i>Terminal</span>
                    <div class="cmd-text" id="repo-cmd">Loading...</div>
                </div>

                <div class="search-wrapper">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="search-input" class="search-input" placeholder="‚ú® ÊêúÁ¥¢ Chart ÂêçÁß∞ÊàñÊèèËø∞...">
                </div>

            </div>

            <hr class="my-4" style="border-top: 2px dashed rgba(0,0,0,0.1);">
            
            <div id="loading" class="text-center py-5">
                <div class="spinner-border text-danger" style="width: 3rem; height: 3rem;" role="status"></div>
                <h4 class="mt-3 text-secondary">Ê≠£Âú®Âä†ËΩΩ Charts...</h4>
            </div>
            
            <div id="error-msg" class="alert alert-danger text-center shadow-sm d-none" style="border-radius: 15px;"></div>
            <div class="row g-4" id="chart-list"></div>
            
            <div class="text-center mt-5 text-muted">
                <p style="font-size: 0.85rem; opacity: 0.7;">Hosted with üíñ by GitHub Pages</p>
            </div>
        </div>
    </div>
</div>

<!-- Âª∂ËøüÂä†ËΩΩÈùûÂÖ≥ÈîÆËÑöÊú¨ -->
<script defer src="https://cdn.staticfile.net/js-yaml/4.1.0/js-yaml.min.js"></script>

<script>
    // ÂÖ®Â±ÄÂèòÈáèÂ≠òÂÇ®Êï∞ÊçÆ
    let globalCharts = []; 
    const repoName = 'sakullla';

    // DOM ÂÖÉÁ¥†ÁºìÂ≠ò
    const elements = {};
    
    // DOM Â∞±Áª™ÂêéÂàùÂßãÂåñ
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
    } else {
        init();
    }

    function init() {
        // ÁºìÂ≠ò DOM ÂÖÉÁ¥†ÂºïÁî®
        elements.repoCmd = document.getElementById('repo-cmd');
        elements.searchInput = document.getElementById('search-input');
        elements.loading = document.getElementById('loading');
        elements.errorMsg = document.getElementById('error-msg');
        elements.chartList = document.getElementById('chart-list');
        elements.toastBox = document.getElementById('toast-box');

        const repoUrl = 'https://sakullla.github.io/helm-charts';
        const fullCmd = `helm repo add ${repoName} ${repoUrl}`;
        elements.repoCmd.textContent = fullCmd;

        // ÁªëÂÆöÊêúÁ¥¢‰∫ã‰ª∂
        elements.searchInput.addEventListener('input', debounce(handleSearch, 150));

        // Âä†ËΩΩÊï∞ÊçÆ
        loadCharts();
    }

    async function loadCharts() {
        try {
            const response = await fetch('./index.yaml');
            if (!response.ok) {
                if (response.status === 404) {
                    throw new Error('Êú™ÊâæÂà∞ index.yaml Êñá‰ª∂');
                }
                throw new Error(`HTTP ${response.status}`);
            }
            const yamlText = await response.text();
            
            // Á≠âÂæÖ js-yaml Âä†ËΩΩÂÆåÊàê
            await waitForJsYaml();
            
            const doc = jsyaml.load(yamlText);
            if (doc.entries) {
                globalCharts = Object.keys(doc.entries).map(key => doc.entries[key][0]);
                renderCharts(globalCharts);
            } else {
                renderCharts([]);
            }
        } catch (error) {
            showError('ÁΩëÁªúÂä†ËΩΩÂ§±Ë¥•: ' + error.message);
        }
    }

    function waitForJsYaml() {
        return new Promise((resolve, reject) => {
            if (typeof jsyaml !== 'undefined') {
                resolve();
                return;
            }
            // ËΩÆËØ¢Ê£ÄÊü• js-yaml ÊòØÂê¶Âä†ËΩΩ
            const checkInterval = setInterval(() => {
                if (typeof jsyaml !== 'undefined') {
                    clearInterval(checkInterval);
                    clearTimeout(timeout);
                    resolve();
                }
            }, 50);
            const timeout = setTimeout(() => {
                clearInterval(checkInterval);
                reject(new Error('js-yaml Âä†ËΩΩË∂ÖÊó∂'));
            }, 10000);
        });
    }

    function handleSearch(e) {
        const keyword = e.target.value.toLowerCase().trim();
        if (!keyword) {
            renderCharts(globalCharts);
            return;
        }

        const filtered = globalCharts.filter(chart => {
            const name = (chart.name || '').toLowerCase();
            const desc = (chart.description || '').toLowerCase();
            return name.includes(keyword) || desc.includes(keyword);
        });

        renderCharts(filtered);
    }

    function renderCharts(charts) {
        elements.loading.classList.add('d-none');
        
        if (!charts || charts.length === 0) {
            elements.chartList.innerHTML = '<div class="col-12 text-center text-muted py-5"><h5>üçÉ Ê≤°ÊúâÊâæÂà∞Áõ∏ÂÖ≥ Charts</h5></div>';
            return;
        }

        // ÊåâÂ≠óÊØçÊéíÂ∫è
        const sortedCharts = [...charts].sort((a, b) => a.name.localeCompare(b.name));

        // ‰ΩøÁî® DocumentFragment ÊâπÈáèÊèíÂÖ•
        const fragment = document.createDocumentFragment();
        
        sortedCharts.forEach(chart => {
            const installCmd = `helm install my-${chart.name} ${repoName}/${chart.name}`;
            const escapedCmd = installCmd.replace(/'/g, "\\'").replace(/"/g, '&quot;');
            
            const col = document.createElement('div');
            col.className = 'col-md-6 col-lg-4';
            col.innerHTML = `
                <div class="chart-card">
                    <div class="card-header-custom">
                        <i class="fas fa-cube me-2"></i>${escapeHtml(chart.name)}
                        <span class="version-badge">${escapeHtml(chart.version)}</span>
                    </div>
                    <div class="card-body d-flex flex-column">
                        <p class="card-desc">${escapeHtml(chart.description) || 'ÊöÇÊó†ÊèèËø∞'}</p>
                        <div class="mt-auto">
                            <p class="text-muted mb-2"><small><i class="fas fa-code-branch me-1"></i>Ver: ${escapeHtml(chart.appVersion) || '-'}</small></p>
                            <button class="btn btn-custom" data-cmd="${escapedCmd}">
                                <i class="fas fa-copy me-1"></i> Â§çÂà∂ÂÆâË£ÖÂëΩ‰ª§
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            // ÁªëÂÆöÁÇπÂáª‰∫ã‰ª∂
            const btn = col.querySelector('.btn-custom');
            btn.addEventListener('click', () => copyCmd(btn.dataset.cmd));
            
            fragment.appendChild(col);
        });

        elements.chartList.innerHTML = '';
        elements.chartList.appendChild(fragment);
    }

    function showError(msg) {
        elements.loading.classList.add('d-none');
        elements.errorMsg.innerHTML = '<i class="fas fa-exclamation-circle me-2"></i> ' + escapeHtml(msg);
        elements.errorMsg.classList.remove('d-none');
    }

    function showToast(message) {
        const toast = document.createElement('div');
        toast.className = 'sakura-toast';
        toast.innerHTML = `<i class="fas fa-check-circle"></i><span>${escapeHtml(message)}</span>`;
        elements.toastBox.appendChild(toast);
        
        setTimeout(() => {
            toast.classList.add('hide-toast');
            toast.addEventListener('animationend', () => toast.remove());
        }, 3000);
    }

    async function copyCmd(text) {
        try {
            await navigator.clipboard.writeText(text);
            showToast('Â§çÂà∂ÊàêÂäüÔºÅÂø´ÂéªÂÆâË£ÖÂêß ‚ú®');
        } catch (err) {
            // ÈôçÁ∫ßÊñπÊ°à
            prompt('Â§çÂà∂Â§±Ë¥•ÔºåËØ∑ÊâãÂä®Â§çÂà∂:', text);
        }
    }

    // Èò≤ÊäñÂáΩÊï∞
    function debounce(fn, delay) {
        let timer = null;
        return function(...args) {
            clearTimeout(timer);
            timer = setTimeout(() => fn.apply(this, args), delay);
        };
    }

    // HTML ËΩ¨‰πâÈò≤Ê≠¢ XSS
    function escapeHtml(text) {
        if (!text) return '';
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }
</script>
</body>
</html>
